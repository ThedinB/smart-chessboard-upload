<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firmware – Tadeášova Chytrá Šachovnice</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #333; /* Hlavní tmavá barva (např. pro text, tlačítka) */
      --secondary-color: #555; /* Sekundární tmavá (pro hover efekty) */
      --accent-color: #4CAF50; /* Zvýrazňující barva (zelená šachová) */
      --background-color: #f4f4f4; /* Barva pozadí stránky */
      --container-background: #ffffff; /* Barva pozadí hlavního kontejneru */
      --text-color: #333;
      --light-text-color: #ffffff;
      --error-color: #D8000C; /* Červená pro chyby */
      --success-color: #270; /* Tmavě zelená pro úspěch */
      --info-color: #00529B; /* Modrá pro info */
      --border-radius: 5px;
      --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box; /* Zajistí, že padding neovlivní celkovou šířku/výšku */
    }

    .container {
      background-color: var(--container-background);
      padding: 30px 40px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      text-align: center;
      max-width: 700px;
      width: 100%;
      margin-top: 30px;
    }

    header h1 {
      color: var(--primary-color);
      margin-bottom: 0.5em;
      font-size: 2.2em;
      border-bottom: 2px solid var(--accent-color);
      padding-bottom: 0.5em;
      display: inline-block; /* Aby se border-bottom přizpůsobil textu */
    }

    .intro-text, .instructions-title, .instructions ol li, .upload-section p {
      color: var(--text-color);
      font-size: 1.1em;
      margin-bottom: 1em;
    }

    .instructions {
      text-align: left;
      background-color: #e9e9e9; /* Světlejší pozadí pro návod */
      padding: 20px;
      border-radius: var(--border-radius);
      margin: 20px auto;
      border-left: 5px solid var(--accent-color);
    }

    .instructions-title {
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 0.8em;
      color: var(--primary-color);
    }

    .instructions ol {
      padding-left: 20px;
      margin: 0;
    }

    .instructions ol li {
      margin-bottom: 0.6em;
    }
    .instructions ol li::marker {
        font-weight: bold;
        color: var(--accent-color);
    }

    .upload-button {
      padding: 12px 25px;
      background: linear-gradient(135deg, var(--accent-color) 0%, #3e8e41 100%); /* Gradient zelené */
      color: var(--light-text-color);
      border: none;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: var(--border-radius);
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 20px;
    }

    .upload-button:hover, .upload-button:focus {
      background: linear-gradient(135deg, #3e8e41 0%, var(--accent-color) 100%);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }
    .upload-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .message-area {
      margin-top: 25px;
      padding: 12px;
      border-radius: var(--border-radius);
      font-weight: bold;
      min-height: 20px; /* Aby neměnila layout, když je prázdná */
      display: none; /* Skrytá, dokud není zpráva */
      font-size: 1.05em;
    }

    .message-area.error {
      background-color: #ffdddd; /* Světle červená pro pozadí chyby */
      color: var(--error-color);
      border: 1px solid var(--error-color);
      display: block;
    }

    .message-area.success {
      background-color: #ddffdd; /* Světle zelená pro pozadí úspěchu */
      color: var(--success-color);
      border: 1px solid var(--success-color);
      display: block;
    }
    
    .message-area.info {
      background-color: #e0f2f7; /* Světle modrá pro info */
      color: var(--info-color);
      border: 1px solid var(--info-color);
      display: block;
    }

    footer {
      margin-top: 40px;
      padding: 20px;
      color: #777;
      font-size: 0.9em;
    }
    footer a {
        color: var(--accent-color);
        text-decoration: none;
    }
    footer a:hover {
        text-decoration: underline;
    }

    /* Malá loga nebo ikonky, pokud bys chtěl přidat */
    .icon {
        vertical-align: middle;
        margin-right: 5px;
        height: 1.2em; /* Uprav velikost podle potřeby */
    }

    /* Responzivita */
    @media (max-width: 600px) {
      .container {
        padding: 20px;
        margin-top: 10px;
      }
      header h1 {
        font-size: 1.8em;
      }
      .intro-text, .instructions ol li, .upload-section p {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <h1>Firmware pro Chytrou Šachovnici</h1>
    </header>

    <section class="intro-section">
      <p class="intro-text">
        Vítej! Děkuji ti za podporu mého projektu chytré šachovnice. Na této stránce můžeš nahrát nejnovější firmware přímo do svého Arduina (Uno nebo Nano). Firmware je ve formátu .bin a pro nahrání stačí pár kliknutí.
      </p>
    </section>

    <section class="instructions-section">
      <div class="instructions">
        <p class="instructions-title">Návod k nahrání:</p>
        <ol>
          <li><strong>Připoj Arduino</strong> k počítači pomocí USB kabelu.</li>
          <li>Použij prohlížeč **Google Chrome** nebo **Microsoft Edge**. Jiné prohlížeče nemusí funkci nahrávání podporovat.</li>
          <li>Klikni na tlačítko "Nahrát Firmware" níže.</li>
          <li>V dialogovém okně, které se objeví, **vyber správný sériový port** tvého Arduina a potvrď.</li>
          <li>Nahrávání firmwaru může trvat **10 až 30 sekund**. Vyčkej prosím.</li>
          <li>Po úspěšném nahrání můžeš pokračovat podle instrukcí v PDF manuálu z tvého balíčku.</li>
        </ol>
      </div>
    </section>

    <section class="upload-section">
      <button class="upload-button" onclick="uploadFirmware()">
        <!-- SVG ikona pro upload, volitelná -->
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg>
        Nahrát Firmware
      </button>
      <div id="messageArea" class="message-area">
        <!-- Zprávy pro uživatele se zobrazí zde -->
      </div>
    </section>
  </div>

  <footer>
    <p>© <span id="currentYear"></span> Tadeášova Chytrá Šachovnice. V případě problémů mě kontaktuj na <a href="mailto:tadeas.chess@gmail.com">tadeas.chess@gmail.com</a>.</p>
  </footer>

  <script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    async function uploadFirmware() {
      const messageElement = document.getElementById('messageArea');
      messageElement.textContent = 'Probíhá připojení k Arduinu...';
      messageElement.className = 'message-area info'; // Nastavení třídy pro info

      try {
        if (!navigator.serial) {
          throw new Error('Web Serial API není v tomto prohlížeči podporováno. Prosím, použij nejnovější verzi Google Chrome nebo Microsoft Edge.');
        }
        
        // Požádat o přístup k sériovému portu
        const port = await navigator.serial.requestPort();
        messageElement.textContent = 'Vybraný port se otevírá...';
        messageElement.className = 'message-area info';
        await port.open({ baudRate: 115200 }); // Typická baud rate pro Arduino bootloader

        // Načíst .bin soubor - ujisti se, že máš SmartChessboardFirmware_v1.bin ve stejné složce jako index.html
        // nebo zadej plnou URL, pokud je jinde na GitHub Pages.
        messageElement.textContent = 'Načítám soubor firmwaru...';
        messageElement.className = 'message-area info';
        const firmwareUrl = 'SmartChessboardFirmware_v1.bin'; // ZMĚŇ NÁZEV PODLE POTŘEBY
        const response = await fetch(firmwareUrl); 
        
        if (!response.ok) {
          throw new Error(`Nepodařilo se načíst soubor firmwaru (${firmwareUrl}). Zkontroluj, zda je soubor na serveru a cesta je správná. Stav: ${response.status}`);
        }
        const firmware = await response.arrayBuffer();
        const data = new Uint8Array(firmware);
        
        messageElement.textContent = `Firmware načten (${(data.length / 1024).toFixed(1)} KB). Probíhá nahrávání do Arduina... Nevypínej okno ani neodpojuj Arduino.`;
        messageElement.className = 'message-area info';

        // Jednoduchý protokol pro nahrávání (jako např. STK500v1 pro Arduino Uno/Nano s Optiboot)
        // Tohle je velmi zjednodušené. Reálné nahrávání firmwaru je komplexnější
        // a vyžaduje komunikaci s bootloaderem Arduina.
        // Následující kód pouze odešle data, ale nezaručuje, že je bootloader správně zpracuje
        // bez dalšího handshake a řídících příkazů.
        // Pro robustnější řešení bys pravděpodobně potřeboval knihovnu jako `arduino-uploader-browser`
        // nebo implementovat protokol bootloaderu (což je složité).

        // !!! VAROVÁNÍ: NÁSLEDUJÍCÍ KÓD JE VELMI ZJEDNODUŠENÝ !!!
        // Tento kód pouze odešle binární data. Pro úspěšné nahrání na Arduino Uno/Nano s Optiboot
        // by bylo potřeba implementovat STK500v1 protokol. Web Serial API samotné to neumí.
        // Prozatím to ponecháme jako demonstraci odeslání dat.

        const writer = port.writable.getWriter();
        
        // Odeslání dat po blocích pro lepší přehled a potenciální zpětnou vazbu
        const chunkSize = 512; // Velikost bloku
        for (let i = 0; i < data.length; i += chunkSize) {
            const chunk = data.slice(i, i + chunkSize);
            await writer.write(chunk);
            // messageElement.textContent = `Nahráno ${(i + chunk.length) / 1024} KB z ${(data.length / 1024).toFixed(1)} KB...`;
        }
        // Jednodušší varianta odeslání celého bloku najednou:
        // await writer.write(data);
        
        writer.releaseLock();

        // Počkat chvíli, aby Arduino stihlo restartovat, pokud bootloader tak funguje
        // await new Promise(resolve => setTimeout(resolve, 2000));

        await port.close();
        messageElement.className = 'message-area success';
        messageElement.textContent = 'Data firmwaru byla odeslána na port! Zkontroluj, zda se program na Arduinu spustil správně. Gratuluji!';

      } catch (error) {
        messageElement.className = 'message-area error';
        messageElement.textContent = 'CHYBA: ' + error.message + ' Ujisti se, že máš připojené Arduino, vybral jsi správný port a používáš aktuální Chrome nebo Edge. Pokud problém přetrvává, kontaktuj mě.';
        console.error('Chyba při nahrávání firmwaru:', error);
      }
    }
  </script>
</body>
</html>
